<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>

    <link rel="stylesheet" href="css/cssreset-min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="carousel" id="carousel">
        <ul class="imgUl clearfix" id="imgUl">
            <li class="current"><a href="#"><img src="img/0.jpg" alt=""></a></li>
            <li><a href="#"><img src="img/1.jpg" alt=""></a></li>
            <li><a href="#"><img src="img/2.jpg" alt=""></a></li>
            <li><a href="#"><img src="img/3.jpg" alt=""></a></li>
            <li><a href="#"><img src="img/4.jpg" alt=""></a></li>
        </ul>

        <div class="btn">
			<a type="button" id="leftBtn">&lt; </a>
			<a type="button"  id="rightBtn">&gt; </a>
		</div>

		<div class="state" id="circleNav">
			<ol>
				<li class="current"></li>
				<li></li>
				<li></li>
				<li></li>
				<li></li>
			</ol>
		</div>
    </div>

    <script src="js/animate-2.0.1.js"></script>
    <script>
        var carousel = document.getElementById("carousel");
        var imgUl = document.getElementById("imgUl");
        var imgLi = imgUl.getElementsByTagName("li");

        // 获取按钮
        var rightBtn = document.getElementById("rightBtn");
        var leftBtn = document.getElementById("leftBtn");

        //得到小圆点
        var circleSliderLi = document.getElementById("circleNav").getElementsByTagName("li");
        // 当前图片编号
        var nowIdx = 0;

        var interval = 1800;
        var imgLength = imgLi.length;
        // 透明度变化量
        var step = 0.01;
        var time = 1000;

        // 右按钮事件
        rightBtn.onclick = rightBtnHandler;
        // 自动轮播
        var timer = setInterval(rightBtnHandler,interval);
        //鼠标进入停止
        carousel.onmouseover = function(){
            clearInterval(timer);
        }
        //鼠标离开开始
        carousel.onmouseout = function(){
            timer = setInterval(rightBtnHandler,interval);
        }

        //右按钮的事件处理程序
        function rightBtnHandler() {            
            // 这张淡出，下一张淡入
            animate(imgLi[nowIdx], {opacity: 0}, time);
            nowIdx++;
            if (nowIdx > imgLength - 1) {
                nowIdx = 0;
            }

            animate(imgLi[nowIdx], {opacity: 1}, time);
            changeCircle();
        }

        // 左按钮事件
        leftBtn.onclick = leftBtnHandler;

        function leftBtnHandler() {
            if(imgLi[nowIdx].isanimated) return;
            // 这张淡出，下一张淡入
            animate(imgLi[nowIdx], {opacity: 0}, time);
            nowIdx--;
            if (nowIdx < 0) {
                nowIdx = imgLength - 1;
            }

            animate(imgLi[nowIdx], {opacity: 1}, time);
            changeCircle();
        }


        for(var i = 0; i < imgLength; i++) {
            // 小圆点业务IIFE写法
            (function(i) {
            	circleSliderLi[i].onclick = function() {
            		//点击右按钮的时候，运动机构本身在运动，就不让右按钮有任何作用
            		if(imgLi[nowIdx].isanimated) return;

                    // 小圆点的点击业务
                    animate(imgLi[nowIdx], {opacity: 0}, time);
            		nowIdx = i;
            		animate(imgLi[nowIdx], {opacity: 1}, time);
            		changeCircle();
            	}
            })(i)

            // 小圆点业务添加对象属性写法
            // circleSliderLi[i].index = i;	//先编号
            // circleSliderLi[i].onclick = function(){
            //     //点击小圆点的时候，运动机构本身在运动，就不让右按钮有任何作用
            //     if(imgLi[nowIdx].isanimated) return;
            //     //小圆点的点击业务
            //     animate(imgLi[nowIdx], {opacity: 0}, time);
            //     nowIdx = this.index;
                
            //     animate(imgLi[nowIdx], {opacity: 1}, time);
            //     changeCircle();
            // }
        }

        //更换小圆点函数
        function changeCircle(){
            for (let i = 0; i < circleSliderLi.length; i++) {
                //去掉所有小圆点的cur
                circleSliderLi[i].classList.remove("current");
            }

            //第信号量这个小圆点加cur
            circleSliderLi[nowIdx].classList.add("current");
        }
    </script>
</body>
</html>